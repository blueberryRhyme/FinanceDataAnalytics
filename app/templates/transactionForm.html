{% extends "base.html" %}

{% block title %}Log Transaction{% endblock %}

{% block head %}
<style>
  #other-category-container,
  #transfer-direction-container,
  #category-container {
    display: none;
    margin-top: 0;
    margin-bottom: 20px;
  }
</style>
{% endblock %}

{% block content %}
<div class="page-container">
  <div class="header-with-action">
    <h1>Log Your Transaction</h1>
    <a href="{{ url_for('main.history') }}" class="history-link">
      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
        <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
        <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
      </svg>
      View Transaction History
    </a>
  </div>

  <div class="card">
    <form id="transaction-form"
          class="form-wrapper"
          method="POST"
          action="{{ url_for('main.transactionForm') }}"
          enctype="multipart/form-data">

      {{ form.csrf_token }}

      <!-- Type -->
      <label for="type">{{ form.type.label }}</label>
      {{ form.type(class="input-box") }}
      {% for err in form.type.errors %}<div class="error">{{ err }}</div>{% endfor %}

      <!-- Transfer Direction -->
      <div id="transfer-direction-container">
        <label for="transfer_direction">{{ form.transfer_direction.label }}</label>
        {{ form.transfer_direction(class="input-box") }}
        {% for err in form.transfer_direction.errors %}<div class="error">{{ err }}</div>{% endfor %}
      </div>

      <!-- Amount -->
      <label for="amount">{{ form.amount.label }}</label>
      {{ form.amount(class="input-box", placeholder="Enter amount") }}
      {% for err in form.amount.errors %}<div class="error">{{ err }}</div>{% endfor %}

      <!-- Category -->
      <div id="category-container">
        <label for="category">{{ form.category.label }}</label>
        {{ form.category(class="input-box") }}
        {% for err in form.category.errors %}<div class="error">{{ err }}</div>{% endfor %}
      </div>

      <!-- Other Category -->
      <div id="other-category-container">
        <label for="other_category">{{ form.other_category.label }}</label>
        {{ form.other_category(class="input-box", placeholder="Specify category") }}
        {% for err in form.other_category.errors %}<div class="error">{{ err }}</div>{% endfor %}
      </div>

      <label for="description">{{ form.description.label }}</label>
      {{ form.description(class="input-box", placeholder="Enter Description") }}
      {% for err in form.description.errors %}<div class="error">{{ err }}</div>{% endfor %}


      <!-- Date -->
      <label for="date">{{ form.date.label }}</label>
      {{ form.date(class="input-box") }}
      {% for err in form.date.errors %}<div class="error">{{ err }}</div>{% endfor %}

      <!-- CSV Upload -->
      <label for="csv_file">{{ form.csv_file.label }}</label>
      {{ form.csv_file(class="input-box") }}
      {% for err in form.csv_file.errors %}<div class="error">{{ err }}</div>{% endfor %}

      <!-- Submit -->
      {{ form.submit(class="button") }}
    </form>
  </div>
</div>

<script>
  const typeField         = document.getElementById('type');
  const transferDiv       = document.getElementById('transfer-direction-container');
  const categoryField     = document.getElementById('category');
  const categoryContainer = document.getElementById('category-container');
  const otherDiv          = document.getElementById('other-category-container');

  function updateVisibility() {
    const t = typeField.value;

    transferDiv.style.display       = (t === 'transfer') ? 'block' : 'none';
    categoryContainer.style.display = (t === 'expense' || t === 'income') ? 'block' : 'none';
    otherDiv.style.display          = (categoryField.value === 'other') ? 'block' : 'none';
  }

  document.addEventListener('DOMContentLoaded', () => {
    updateVisibility();
    const dateField = document.getElementById('date');
    if (dateField && !dateField.value) {
      dateField.value = new Date().toISOString().split('T')[0];
    }
  });

  typeField.addEventListener('change', updateVisibility);
  categoryField.addEventListener('change', updateVisibility);
</script>
{% endblock %}
